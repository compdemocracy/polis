# first build or re-build:
# docker-compose up --build
# otherwise:
# docker-compose up

version: "3.1"

services:

  node:
    container_name: polis-server
    build:
      context: ./server
      dockerfile: Dockerfile
    environment:
      STATIC_FILES_HOST: static
      STATIC_FILES_PORT: 8080
      STATIC_FILES_ADMINDASH_PORT: 8080
      SHOULD_USE_TRANSLATION_API: 'false'
    depends_on:
      - 'postgres'
      - 'static'
    networks:
      - 'polis-dev'
    ports:
      - "5000:5000"


  math:
    container_name: polis-math
    depends_on:
      - 'postgres'
    build:
      context: ./math


  postgres:
    container_name: polis-db
    restart: always
    build:
      context: ./server
      dockerfile: Dockerfile-db
    networks:
      - 'polis-dev'
    volumes:
      - 'backups:/backups'
      - 'postgres:/var/lib/postgresql/data'

  nginx-proxy:
    container_name: polis-nginx-proxy
    build:
      context: ./fileServer
      dockerfile: nginx.Dockerfile
    depends_on:
      - 'static'
    networks:
      - 'polis-dev'
    ports:
      - '80:80'

  static:
    container_name: polis-static
    build:
      context: ./fileServer
      dockerfile: Dockerfile
    depends_on:
      - 'client'
      - 'client-admin'
    networks:
      - 'polis-dev'
    ports:
      - '8080:8080'

  client:
    image: polis-participation
    build:
      context: ./clientParticipation
      args:
        GIT_HASH: null

  client-admin:
    image: polis-admin
    build:
      context: ./clientAdmin
      args:
        GIT_HASH: null



networks:
  polis-dev:

volumes:
  backups:
  postgres:

